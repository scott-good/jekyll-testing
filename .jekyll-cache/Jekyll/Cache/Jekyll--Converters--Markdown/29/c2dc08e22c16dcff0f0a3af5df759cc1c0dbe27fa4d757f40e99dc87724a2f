I"»I<h4 id="4-solution-console-ui-integration">4. Solution Console UI Integration</h4>

<p>Each SoFy Solution includes an administrative front-end UI called <em>Solution Console</em>, designed to help users to easily navigate and troubleshoot all of the products and services included in the solution. Product-specific contents can be added to the Solution Console by editing the Kubernetes ConfigMap <code>./templates/sofy-config.yaml</code> which is included in the chart generated by SoFy. This ConfigMap contains a data property named <code>sofy-config.json</code> with a string value in JSON format.</p>

<p><code>sofy-config.yaml</code> will continue to evolve, but currently you can use it to:</p>

<ul>
  <li><a href="#providing-links-to-your-end-points">Provide links to Your End Points</a></li>
  <li><a href="#disable-default-public-routes-and-default-authentication">Disable default public routes and default authentication</a></li>
  <li><a href="#expose-additional-application-log-files">Expose additional application log files</a></li>
  <li><a href="#specify-required-flexnet-feature-names">Specify required FlexNet feature names</a></li>
</ul>

<p>Each of these otions is described in more detail below.</p>

<p><strong>Note</strong>:</p>
<ol>
  <li><code>sofy-config.yaml</code> is only required for SoFy integration and does not have any effect in your product chart stand-alone. It can even be safely removed for the chart stand-alone.</li>
  <li>This is because the full content of <code>sofy-config.yaml</code> is enclosed in <code>and</code>, and <code>global.sofySolution=true</code> only during solution creation time.</li>
  <li>At sofy solution creation time, all <code>sofy-config.yaml</code> will be aggregated into one <code>sofy-config.yaml</code> for the solution only.</li>
</ol>

<p><em>Example sofy-config.yaml file:</em></p>

<pre><code class="language-yaml">
{{- if .Values.global.sofySolution }}
apiVersion: v1
kind: ConfigMap
data:
  sofy-config.json: 
    {
        "chartName": "{{ .Chart.Name }}",
        "version": "{{ .Chart.Version }}",
        "displayName": "{{ .Values.displayName }}",
        "type": "demopack",
        "flexnetFeatures": [ "ODB_CPU" ],
        "links":[
          {
              "displayName": "Public Documentation",
              "type": "ui",
              "static": true,
              "url": "https://hclsw.com/doc"
          },
          {
              "displayName": "OneGuru Home Page",
              "type": "ui",
              "static": false,
              "subdomain": "oneguru",
              "path": "/home",
              "credentials": [
                  {
                      "displayName": "Default Admin Login",
                      "username": "admin",
                      "password": "admin"
                  },
                  {
                      "displayName": "Default User Login",
                      "username": "bob",
                      "password": "pass"
                  }
              ]
          },
          {
              "displayName": "OneDB API Root",
              "type": "apiroot",
              "static": false,
              "subdomain": "oneguru",
              "path": "/datasynth/1.0"
          },
          {
              "displayName": "OneDB REST API",
              "type": "openapiui",
              "static": false,
              "subdomain": "onedb-rest",
              "path": "/",
              "credentials": [
                  {
                      "username": "onedbsa",
                      "password": "onedb4ever"
                  }
              ]
          },
          {
              //expected connection URL: "jdbc:onedb://x.x.x.x.nip.io:3033"
              "displayName": "SQL Native OneDB Connection URL",
              "type": "nonhttp",
              "static": false,
              "prefix": "jdbc:onedb://",
              "port": "3033",
              "credentials": []
          },
          {
              //expected connection URL: "jdbc:db2://x.x.x.x.nip.io:3033"
              "displayName": "SQL Native OneDB Connection URL",
              "type": "nonhttp",
              "static": false,
              "prefix": "jdbc:db2://",
              "port": "3034",
              "credentials": []
          },
          {
              //expected connection URL: "x.x.x.x:8088", x.x.x.x being the external IP address of service "{{ .Release.Name }}-nrpc-service"
              "displayName": "Domino NRPC Connection",
              "type": "loadbalancer",
              "static": false,
              "serviceName": "{{ .Release.Name }}-nrpc-service",
              "prefix": "",
              "port": "8088",
              "credentials": []
          }
      ]
    }
{{- end }}

</code></pre>

<h5 id="providing-links-to-your-end-points">Providing Links to Your End Points</h5>

<p>The <em>SoFy Solution Console UI</em> can display links to your applicationâ€™s public endpoints. This greatly improves the user experience by providing easy navigation to key points in your application from a common landing page. You can expose both static and dynamic links by declaring them in the <code>sofy-config.yaml</code> ConfigMap:</p>

<pre><code class="language-yaml">
data:
  sofy-config.json: 
     {
        "chartName": "{{ .Chart.Name }}",
        "version": "{{ .Chart.Version }}",
        "displayName": "{{ .Values.displayName }}",
        "type": "demopack",
        "flexnetFeatures": [ "ODB_CPU" ],
        "links":[
          {
              "displayName": "Public Documentation",
              "type": "ui",
              "static": true,
              "url": "https://hclsw.com/doc"
          },
          {
              "displayName": "OneGuru Home Page",
              "type": "ui",
              "static": false,
              "subdomain": "oneguru",
              "path": "/home",
              "credentials": [
                  {
                      "displayName": "Default Admin Login",
                      "username": "admin",
                      "password": "admin"
                  },
                  {
                      "displayName": "Default User Login",
                      "username": "bob",
                      "password": "pass"
                  },
                  . . .
              ]
           }
        ]
     }

</code></pre>

<h6 id="links-schema">Links Schema</h6>

<p><strong>sofy-console UI</strong> will support the following types:</p>

<table>
  <thead>
    <tr>
      <th><strong>links.type</strong></th>
      <th>purpose</th>
      <th>displayed as hyperlink in UI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>apiroot</strong></td>
      <td>URL to your REST API root for information purpose.</td>
      <td>no</td>
    </tr>
    <tr>
      <td><strong>loadbalancer</strong></td>
      <td>None TCP protocals canâ€™t be routed through ambassador. like UDP or NRPC. Such <code>loadbalancer</code> type of k8s services have to be exposed directly via a load balancer from the cloud provider with an external IP and address and port.</td>
      <td>no</td>
    </tr>
    <tr>
      <td><strong>nonhttp</strong></td>
      <td>TCP or other none HTTP protocol connection string. These are not accessible from SoFy sandbox install. Only accessible from non-sandbox installs.</td>
      <td>no</td>
    </tr>
    <tr>
      <td><strong>openapiui</strong></td>
      <td>a link to a REST swagger UI or other API UI like GRAPHQL</td>
      <td>yes</td>
    </tr>
    <tr>
      <td><strong>ui</strong></td>
      <td>a link to a web user interface.</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>

<p>A link can be either static or non-static link.  Non-static links are public endpoints routed by Ambassador.</p>

<table>
  <thead>
    <tr>
      <th><strong>links.static</strong></th>
      <th>purpose</th>
      <th>displayed as hyperlink in UI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>true</strong></td>
      <td>To a static link. Provide the full URL string in <code>url</code></td>
      <td>yes</td>
    </tr>
    <tr>
      <td><strong>false</strong></td>
      <td>Links relative to ambassador public domain or IP.</td>
      <td>depends on <code>links.type</code></td>
    </tr>
  </tbody>
</table>

<h6 id="links-schema-deprecating-soon">Links Schema (Deprecating soon)</h6>

<p><strong>NOTE</strong>: This schema will be deprecating after SoFy Solution Console UI added support for the new schema.</p>

<p>For HTTP end points, use one or all of the following under <code>contextRoots</code>:</p>

<table>
  <thead>
    <tr>
      <th><strong>contextRoots</strong></th>
      <th>Purpose</th>
      <th>Displayed as hyperlink in UI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>apiroot</strong></td>
      <td>The root URI of your APIs. Can be <code>/</code></td>
      <td>no</td>
    </tr>
    <tr>
      <td><strong>openapiui</strong></td>
      <td>The URI for swagger ui or other API UI</td>
      <td>yes</td>
    </tr>
    <tr>
      <td><strong>ui.key.DefaultLogin</strong></td>
      <td>Default Admin credential as documented in user doc. Required if exist.</td>
      <td>no</td>
    </tr>
    <tr>
      <td><strong>ui.key.endpoint</strong></td>
      <td>GUI URIs</td>
      <td>yes</td>
    </tr>
  </tbody>
</table>

<p>For each of the above elements, include KEY-VALUE pairs:</p>
<ul>
  <li>KEY: name of the link displayed in Solution Console</li>
  <li>VALUE: a relative URI path to your serviceâ€™s public route. UI will display the full URL by appending this value to the serviceâ€™s public route.</li>
</ul>

<p>For Non-HTTP end points like TCP, use <code>others</code> under <code>contextRoots</code>. It can contain one or all of the following:</p>

<table>
  <thead>
    <tr>
      <th><strong>contextRoots</strong></th>
      <th>Purpose</th>
      <th>Displayed as hyperlink in UI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>others.key.connection</strong></td>
      <td>TCP Endpoint URI</td>
      <td>no</td>
    </tr>
    <tr>
      <td><strong>others.key.DefaultLogin</strong></td>
      <td>Default Admin credential as documented in user doc. Required if exist.</td>
      <td>no</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>KEY: name of the link displayed in Solution Console</li>
</ul>

<p><strong>Note</strong>:</p>
<ol>
  <li>Surround links elements with <code>{{- if not .Values.disablePublicRoute }}</code> and ``.  When no public routes exist for the service, there should not be any public URLs available for end users. The service will still be available as an internal service inside the solution in this case.</li>
  <li>See more details on <code>disablePublicRoute</code> below.</li>
</ol>

<p><em>Example:</em></p>

<pre><code class="language-yaml">
{{- if .Values.global.sofySolution }}
apiVersion: v1
kind: ConfigMap
data:
  sofy-config.json: |-
    {
        "name": "{{ .Chart.Name }}",
        "version": "{{ .Chart.Version }}",
        "displayName": "{{ .Values.displayName }}",
        "flexnetFeatures": [ "ODB_CPU" ],
        "services": {
            "{{ include "test-data-synth.fullname" . }}": {
                {{- if not .Values.disablePublicRoute }}
                "contextRoots": {
                    "apiroot": {
                        "REST": "/datasynth/1.0",
                        "GRAPHQL": "/datasynth/gql"
                    },
                    "openapiui": {
                        "REST": "/openapi/ui",
                        "GRAPHQL": "/openapi/ui"
                    },
                    "ui": {
                        "Home Page": {
                          "endpoint": "/home",
                          "DefaultLogin": {
                            "username": "admin",
                            "password": "admin"
                          }
                        },
                        "Admin Console": {
                          "endpoint": "/console",
                          "DefaultLogin": {
                            "username": "consoleAdmin",
                            "password": "admin"
                        }
                    },
                    "others": {
                      "drda": {
                        "connection": "{{ .Values.global.domain }}:{{ .Values.service.externalPort }}",
                        "DefaultLogin": {
                          "username": "consoleAdmin",
                          "password": "admin"
                        }
                      }
                    }
                },
                {{- end }}
                "disablePublicRoute": "{{ .Values.disablePublicRoute }}",
                "disableAccessControl": "{{ .Values.disableAccessControl }}"
            }
        }
    }
{{- end }}

</code></pre>

<h5 id="disable-default-public-routes-and-default-authentication">Disable default public routes and default authentication</h5>

<p>Public routes are automatically created in SoFy solutions for all Kubernetes services exposed in your appâ€™s Helm chart. However, in some use cases it may make sense to not expose certain services publicly, or to disable all public routes for your chartâ€™s dependencies. For example, generally applications do not wish to publicly expose their database backend.</p>

<p>When Access Control Service (ACS) is selected during the creation of a SoFy Solution, by default ACS is also enabled for all included appsâ€™ public routes in addition to protecting SoFyâ€™s common routes such as the Solution Console UI. Applications which include authentication that has not been integrated with SoFyâ€™s ACS may want to disable ACS for the servicesâ€™ routes.</p>

<p>Adding <code>disablePublicRoute</code> and <code>disableAccessControl</code> elements to your Kubernetes services in <code>sofy-config.yaml</code> and in the chartâ€™s <code>values.yaml</code> file will achieve this and make it possible to define a default behavior for the application, while still allowing a parent chart to overwrite this behavior as a dependency.</p>

<p>Note: When <code>disablePublicRoute</code> is set to <code>true</code>, <code>disableAccessControl</code> is effectively <code>true</code>, as well, because that element is not accessible.</p>

<p><em>Example: sofy-config.yaml</em></p>

<pre><code class="language-yaml">
{{- if .Values.global.sofySolution }}
apiVersion: v1
kind: ConfigMap
data:
  sofy-config.json: |-
      {
        "name": "{{ .Chart.Name }}",
        "description": "{{ .Chart.Description }}",
        "version": "{{ .Chart.Version }}",
        "displayName": "SoFy HTTP Debug",
        "services": {
          "{{ include "snoop.fullname" . }}-rest": {
            "disablePublicRoute" : "{{ .Values.disablePublicRoute }}",
            "disableAccessControl" : "{{ .Values.disableAccessControl }}"
          }

</code></pre>

<p><em>Use Case 1: From the Informix chartâ€™s <strong>values.yaml</strong>, allow public route access,but disable ACS for Informix itself.</em></p>

<pre><code class="language-yaml">disablePublicRoute: false
disableAccessControl: true
</code></pre>

<p><em>Use Case 2: From the Workload Automation chartâ€™s <strong>values.yaml</strong>, disable ACS for Workload Automation, and also disable both the public route access and ACS for Informix (as a child chart of Workload Automation).</em></p>

<pre><code class="language-yaml">disablePublicRoute: false
disableAccessControl: true

informix:
  disablePublicRoute: true
  disableAccessControl: true
</code></pre>

<h5 id="expose-additional-application-log-files">Expose additional application log files</h5>

<p>SoFy Solution users can access container console logs by default from Solution Console UI.</p>

<p>If there are additional log files from within application containers that are useful for support, you can define them in the <code>sofy-config.json</code> section of <code>sofy-config.yaml</code> so they can also be accessed and downloaded from the SoFy Solution Console.</p>

<p>In the <code>sofy-config.json</code> data, add an <code>additionalLogFiles</code> section under the Kubernetes <code>services</code> of the specific productâ€™s container, as shown in the example below.</p>

<p><strong>Note</strong>: Each <code>additionalLogFiles</code> entry must be specified using the fully-qualified path to either (a) a specific log file, or (b) a folder of log files.</p>

<p><em>Example</em></p>

<pre><code class="language-yaml">
{{- if .Values.global.sofySolution }}
apiVersion: v1
kind: ConfigMap
data:
  sofy-config.json: |-
    {
        "name": "{{ .Chart.Name }}",
        "description": "{{ .Chart.Description }}",
        "version": "{{ .Chart.Version }}",
        "services": {
            "{{ include "wa.fullName" . }}": {
                "additionalLogFiles": {
                  "{{ .Chart.Name }}": {
                    "stdlist_jm": "/home/wauser/wadata/stdlist/JM/JobManager_message.log",
                    "stdlist_jmGw": "/home/wauser/wadata/stdlist/JM/JobManagerGW_message.log",
                    "engineServer": "/home/wauser/wadata/stdlist/appserver/engineServer/logs"
                  }
                },
                {{- if not .Values.disablePublicRoute }}
                "contextRoots": {
                    "ui": {
                        "Home Page": "/datasynth/appgui",
                        "Admin Console": "/datasynth/admingui"
                    }
                }
                {{- end }}

</code></pre>

<h5 id="specify-required-flexnet-feature-names">Specify required FlexNet feature names</h5>

<p>Licensing issues are often hard to troubleshoot, both by individual users and by support. Details of important information such as FlexNet license features required by the product, usersâ€™ required entitlements, and so on, can often be hard to identify. Because of this, SoFy includes an ability to track and display FlexNet licensing requirements in the SoFy Solution Console.</p>

<p>For products which include FlexNet runtime license checks, add a <code>flexnetFeatures</code> array of required entitlement names to the <code>sofy-config.json</code> data of the <code>sofy-config.yaml</code> file:</p>

<p><code>"flexnetFeatures": [ "HWA_Jobs","HID_CPU" ]</code></p>

<p><em>Example</em></p>

<pre><code class="language-yaml">
{{- if .Values.global.sofySolution }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "wa.fullName" . }}-sofy-config
  labels:
    app.kubernetes.io/name: {{ include "wa.appName" . }}
    app.kubernetes.io/instance: {{ .Release.Name }}
data:
  sofy-config.json: |-
    {
        "name": "{{ .Chart.Name }}",
        "description": "{{ .Chart.Description }}",
        "version": "{{ .Chart.Version }}",
        "displayName": "HCL WorkLoad Automation",
        "flexnetFeatures": [ "HWA_Jobs","HID_CPU" ],
        "services": {

</code></pre>
:ET